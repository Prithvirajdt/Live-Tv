name: Update Master Playlist

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Create folders
        run: |
          mkdir -p sources
          mkdir -p build

      - name: Download playlists
        run: |
          wget -O sources/lgtv.m3u https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/lgtv.m3u
          wget -O sources/jtv.m3u https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/jtv.m3u
          wget https://raw.githubusercontent.com/fakeall12398-sketch/JIO_TV/refs/heads/main/zee.m3u

      - name: Build master playlist
        run: |
          echo "#EXTM3U" > build/master.m3u
          if [ -f static/my_static.m3u ]; then
            sed '1d' static/my_static.m3u >> build/master.m3u
          fi
          for f in sources/*.m3u; do
            sed '1d' "$f" >> build/master.m3u
          done

      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "Auto update master playlist" || true
          git push
